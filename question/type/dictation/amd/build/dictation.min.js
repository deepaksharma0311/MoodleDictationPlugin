define(["jquery"],function(a){"use strict";var b=0,c=0,d=!0;function e(e){c=e.maxplays||0,d=e.enableaudio;var f=a("#q"+e.questionid);0===f.length&&(f=a(".qtype_dictation").first()),f.length>0&&(g(f),h(f))}function g(e){var f=e.find("audio").first(),g=e.find(".audio-play-btn"),h=e.find(".play-counter"),i=e.find('input[name*="playcount"]');if(0===f.length||!d)return void e.find(".audio-controls").hide();function j(){return 0===c||b<c}function k(){f[0]&&j()&&f[0].play().catch(function(a){console.error("Audio play failed:",a)})}function l(){j()?(g.prop("disabled",!1),g.find(".btn-text").text("Play Audio")):(g.prop("disabled",!0),g.find(".btn-text").text("Play limit reached"))}function m(){h.length>0&&(c>0?h.text(b+" / "+c):h.text(b))}function n(){i.length>0&&i.val(b)}i.length>0&&i.val()&&(b=parseInt(i.val())||0),l(),m(),g.on("click",function(a){a.preventDefault(),j()&&k()}),f.on("ended",function(){b++,n(),l(),m()}),f.on("error",function(){console.error("Audio failed to load"),g.prop("disabled",!0).text("Audio Error")})}function h(b){var c=b.find('input[type="text"][name*="gap"]');c.on("focus",function(){a(this).addClass("gap-focused")}),c.on("blur",function(){a(this).removeClass("gap-focused")}),c.on("keydown",function(a){if("Enter"===a.key){a.preventDefault();var b=c.index(this),d=c.eq(b+1);d.length>0&&d.focus()}})}return{init:e}});